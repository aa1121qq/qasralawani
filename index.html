<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>متجر قصر الأواني</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary: #035cb1;
      --accent: #13c391;
      --danger: #e44545;
      --bg: #c5c8cf;
      --card: #fff;
    }
    body {
      font-family: 'Cairo', Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      min-height: 100vh;
    }
    .main-wrapper {
      max-width: 1100px;
      margin: 55px auto 0;
      padding: 30px 30px 60px 30px;
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 8px 32px #0001;
    }
    .products-title {font-size: 2.1rem; margin-bottom: 28px;}
    .products-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 34px;
    }
    .product-card {
      background: #fafbfe;
      border-radius: 16px;
      box-shadow: 0 3px 13px #0001;
      padding: 22px 18px 16px 18px;
      text-align: center;
      transition: box-shadow 0.2s;
    }
    .product-card:hover { box-shadow: 0 8px 20px #0002; }
    .product-img {
      width: 100px; height: 100px;
      object-fit: contain;
      margin-bottom: 10px;
    }
    .product-name { font-size: 1.15rem; margin-bottom: 8px;}
    .badge {
      display: inline-block; margin: 2px 4px 2px 0; font-size: 12px;
      background: var(--accent); color: #fff;
      padding: 2px 9px; border-radius: 8px;
    }
    .cart-btn {
      margin-top: 16px; background: var(--primary); color: #fff;
      border: none; padding: 8px 30px; border-radius: 13px; cursor: pointer;
      font-size: 1rem; transition: background 0.18s;
    }
    .cart-btn:disabled {background: #b8b8b8; cursor:not-allowed;}
    .cart-link {
      position: fixed; top: 20px; left: 30px; z-index: 10;
      background: #f4f4f4; color: var(--primary); font-weight: bold;
      font-size: 1.1rem;
      padding: 12px 30px;
      border-radius: 24px; box-shadow: 0 2px 9px #0001;
      cursor: pointer; transition: background 0.2s;
      border: 2px solid #eaeaea;
    }
    .cart-link:hover {background: #e4eefa;}
    /* Popup */
    .popup-bg {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(24, 34, 56, 0.23);
      display: flex; align-items: center; justify-content: center; z-index: 100;
    }
    .popup {
      background: var(--card); padding: 36px 32px;
      border-radius: 22px; box-shadow: 0 7px 32px #0002;
      min-width: 340px; text-align: center;
    }
    .popup select, .popup button {
      font-size: 1.1rem;
      padding: 8px 12px;
      margin: 7px 0;
      width: 90%;
      border-radius: 9px;
      border: 1.5px solid #ccc;
      outline: none;
      margin-bottom: 18px;
      background: #f6f8fa;
    }
    .popup .skip-btn {
      background: none; color: var(--primary); border: none; cursor: pointer; font-size: 1.05rem; margin-top: 6px;
      text-decoration: underline;
    }
    /* Cart & checkout */
    .cart, .checkout {
      max-width: 650px; margin: 60px auto 0; background: var(--card);
      border-radius: 15px; box-shadow: 0 5px 18px #0002; padding: 22px 18px 28px 18px;
    }
    .cart h2, .checkout h2 {margin-top:0; margin-bottom: 20px;}
    .cart-items, .checkout-products {margin-bottom:20px;}
    .product-mini {
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid #eee; padding: 10px 0;
    }
    .product-mini:last-child {border-bottom:none;}
    .mini-name {flex:1;}
    .remove-btn {background: none; color: var(--danger); border:none; font-size:1.2rem; cursor: pointer;}
    .red-bar {
      background: #fbeaea; color: var(--danger);
      padding: 3px 9px; border-radius: 8px; margin-right: 12px; font-size:13px;
    }
    .green {color: #14a659;}
    .red {color: var(--danger);}
    /* Checkout options */
    .checkout-options { margin: 24px 0;}
    .option-box {
      border: 1.5px solid #e6e6e6; border-radius: 13px; padding: 15px 16px 12px 16px; margin-bottom: 13px;
    }
    .option-title { font-weight: bold; font-size: 1.15rem;}
    .option-availability { margin-top: 5px; font-size: 14px; color:#666;}
    .disabled {opacity: 0.4; pointer-events: none;}
    .complete-btn {background: var(--accent); color: #fff; padding: 9px 22px; border: none; border-radius: 11px; cursor: pointer; margin-top: 18px;}
    @media (max-width:950px) {
      .main-wrapper {max-width:98vw;}
      .products-grid {grid-template-columns: 1fr;}
      .cart-link {left: 8px;}
    }
    @media (max-width:700px) {
      .main-wrapper {padding:8px;}
      .cart, .checkout {padding:10px;}
      .popup {min-width:90vw;}
    }
  </style>
</head>
<body>
<!-- البوب اب -->
<div id="popup-bg" class="popup-bg">
  <div class="popup">
    <h2 style="margin-bottom:17px;">اختر المدينة والحي</h2>
    <select id="city">
      <option value="" selected disabled>اختر المدينة</option>
      <option value="الرياض">الرياض</option>
    </select><br>
    <select id="district">
      <option value="" selected disabled>اختر الحي</option>
      <option value="حي الورود">حي الورود</option>
    </select><br>
    <button class="cart-btn" style="width:92%;" id="confirm-location">تأكيد</button>
    <br>
    <button class="skip-btn" onclick="skipLocation()">تخطي تحديد العنوان</button>
  </div>
</div>

<div class="cart-link" onclick="showCart()">
  🛒 السلة (<span id="cart-count">0</span>)
</div>

<div class="main-wrapper" id="main-wrapper">
  <div class="products-title">منتجاتنا</div>
  <div class="products-grid" id="products-list"></div>
</div>

<!-- السلة -->
<div id="cart" class="cart" style="display:none;">
  <h2>سلة التسوق</h2>
  <div class="cart-items" id="cart-items"></div>
  <button class="cart-btn" style="margin-top:18px;" onclick="goCheckout()">إكمال الطلب</button>
  <button class="cart-btn" style="background:#bbb;color:#333;margin-top:18px;" onclick="hideCart()">متابعة التسوق</button>
</div>

<!-- صفحة اكمال الطلب -->
<div id="checkout" class="checkout" style="display:none;">
  <h2>إكمال الطلب</h2>
  <div class="checkout-options">
    <div class="option-box">
      <div class="option-title">🚚 شحن عادي</div>
      <div class="option-availability" id="normal-availability"></div>
      <div class="checkout-products" id="normal-products"></div>
      <button class="complete-btn" id="complete-normal" onclick="completeOrder('normal')">إتمام الطلب</button>
    </div>
    <div class="option-box">
      <div class="option-title">⚡ شحن سريع</div>
      <div class="option-availability" id="fast-availability"></div>
      <div class="checkout-products" id="fast-products"></div>
      <button class="complete-btn" id="complete-fast" onclick="completeOrder('fast')">إتمام الطلب</button>
    </div>
    <div class="option-box">
      <div class="option-title">🏪 استلام من المعرض</div>
      <div class="option-availability" id="store-availability"></div>
      <div class="checkout-products" id="store-products"></div>
      <div style="margin-top:8px;font-size:15px;">معرض حي الورود:
        <span id="store-status"></span>
      </div>
      <button class="complete-btn" id="complete-store" onclick="completeOrder('store')">إتمام الطلب</button>
    </div>
  </div>
  <button class="cart-btn" style="background:#bbb;color:#333;" onclick="hideCheckout()">عودة</button>
</div>

<script>
const products = [
  {
    id: 1,
    name: "قلاية هوائية",
    image: "https://imgs.qasralawani.net/media/catalog/product/d/s/dsc_0507.jpg",
    stock: { 'مخزن الورود': 1, 'مخزن المتجر الالكتروني': 0 }
  },
  {
    id: 2,
    name: "ماكينة قهوة",
    image: "https://i.imgur.com/I0u1PLP.png",
    stock: { 'مخزن الورود': 0, 'مخزن المتجر الالكتروني': 1 }
  },
  {
    id: 3,
    name: "مايكروييف",
    image: "https://i.imgur.com/bP3OKDT.png",
    stock: { 'مخزن الورود': 1, 'مخزن المتجر الالكتروني': 1 }
  },
];

let userDistrict = "";
let userSkipped = false;
let cart = [];

// البوب اب عند الدخول
document.getElementById("confirm-location").onclick = () => {
  const city = document.getElementById("city").value;
  const dist = document.getElementById("district").value;
  if(city && dist) {
    userDistrict = dist;
    userSkipped = false;
    document.getElementById("popup-bg").style.display = "none";
    showProducts();
  }
}

function skipLocation() {
  userDistrict = "";
  userSkipped = true;
  document.getElementById("popup-bg").style.display = "none";
  showProducts();
}

// عرض المنتجات ككروت
function showProducts() {
  let html = "";
  products.forEach(p => {
    // فقط المنتجات المتوفرة في مخزن المتجر الالكتروني إذا تم التخطي
    let available = userSkipped
      ? (p.stock['مخزن المتجر الالكتروني'] > 0)
      : (p.stock['مخزن المتجر الالكتروني'] > 0 || (userDistrict == "حي الورود" && p.stock['مخزن الورود'] > 0));
    let badge = "";
    if (p.stock['مخزن المتجر الالكتروني'] > 0) badge += `<span class="badge">متوفر في المتجر الالكتروني</span>`;
    if (!userSkipped && userDistrict == "حي الورود" && p.stock['مخزن الورود'] > 0) badge += `<span class="badge" style="background:#1e97ed">متوفر في مخزن الورود</span>`;
    html += `
      <div class="product-card">
        <img src="${p.image}" class="product-img" alt="${p.name}">
        <div class="product-name">${p.name}</div>
        ${badge}
        <br>
        <button class="cart-btn" onclick="addToCart(${p.id})" ${available ? "" : "disabled"}>أضف للسلة</button>
      </div>
    `;
  });
  document.getElementById("products-list").innerHTML = html;
  updateCartCount();
}

// ---- السلة ----
function showCart() {
  document.getElementById("cart").style.display = "block";
  let html = "";
  cart.forEach(item => {
    const p = products.find(x=>x.id==item.id);
    html += `
      <div class="product-mini">
        <span class="mini-name">${p.name}</span>
        <button class="remove-btn" onclick="removeFromCart(${p.id})">✕</button>
      </div>
    `;
  });
  document.getElementById("cart-items").innerHTML = html || "<div>السلة فارغة</div>";
}

function hideCart() {
  document.getElementById("cart").style.display = "none";
}

function addToCart(id) {
  if(!cart.some(x=>x.id==id)) cart.push({id});
  updateCartCount();
  showCart();
}

function removeFromCart(id) {
  cart = cart.filter(x=>x.id != id);
  showCart();
  updateCartCount();
}

function updateCartCount() {
  document.getElementById("cart-count").textContent = cart.length;
}

// ---- اكمال الطلب ----
function goCheckout() {
  document.getElementById("cart").style.display = "none";
  document.getElementById("checkout").style.display = "block";
  renderCheckout();
}

function hideCheckout() {
  document.getElementById("checkout").style.display = "none";
  showProducts();
}

function renderCheckout() {
  const items = cart.map(c => {
    const prod = products.find(p => p.id == c.id);
    return {
      ...prod,
      inStore: prod.stock['مخزن الورود'] > 0,
      inOnline: prod.stock['مخزن المتجر الالكتروني'] > 0
    }
  });

  // شحن عادي: المنتجات المتوفرة في المتجر الالكتروني فقط
  let normalAvail = items.filter(p => p.inOnline).length;
  document.getElementById("normal-availability").innerHTML =
    `${normalAvail} من ${items.length} من المنتجات متوفرة`;
  let normalProds = "";
  items.forEach(item => {
    normalProds += `<div style="margin-bottom:7px;">
      <span>${item.name}</span>
      ${!item.inOnline ? `<span class="red-bar">غير متوفر للتوصيل</span> <button class="remove-btn" onclick="removeCheckout(${item.id})">حذف</button>` : ""}
    </div>`;
  });
  document.getElementById("normal-products").innerHTML = normalProds;

  // شحن سريع: إذا اخترت حي الورود وجميع المنتجات متوفرة في مخزن الورود فقط (غير متاح عند التخطي)
  let allowFast = !userSkipped && userDistrict === "حي الورود" && items.length>0 && items.every(p=>p.inStore);
  document.getElementById("fast-availability").innerHTML =
    allowFast ? `${items.length} من ${items.length} من المنتجات متوفرة (حي الورود)` :
    `شحن سريع متاح فقط إذا كانت كل المنتجات متوفرة في مخزن الورود`;
  let fastProds = "";
  items.forEach(item => {
    fastProds += `<div style="margin-bottom:7px;">
      <span>${item.name}</span>
      ${(!item.inStore && allowFast) ? `<span class="red-bar">غير متوفر للشحن السريع</span> <button class="remove-btn" onclick="removeCheckout(${item.id})">حذف</button>` : ""}
    </div>`;
  });
  document.getElementById("fast-products").innerHTML = fastProds;
  document.getElementById("complete-fast").className = allowFast ? "complete-btn" : "complete-btn disabled";
  document.getElementById("complete-fast").disabled = !allowFast;

  // استلام من المعرض (متاح فقط إذا لم يتم التخطي)
  let storeAvail = items.filter(p => p.inStore).length;
  document.getElementById("store-availability").innerHTML =
    `${storeAvail} من ${items.length} من المنتجات متوفرة`;
  let storeProds = "";
  items.forEach(item => {
    storeProds += `<div style="margin-bottom:7px;">
      <span>${item.name}</span>
      ${!item.inStore ? `<span class="red-bar">غير متوفر في معرض الورود</span> <button class="remove-btn" onclick="removeCheckout(${item.id})">حذف</button>` : ""}
    </div>`;
  });
  document.getElementById("store-products").innerHTML = storeProds;
  if (storeAvail > 0)
    document.getElementById("store-status").innerHTML = `<span class="green">متوفر (${storeAvail})</span>`;
  else
    document.getElementById("store-status").innerHTML = `<span class="red">لا يوجد منتجات متوفرة</span>`;
  // زر الإتمام للاستلام من المعرض: غير متاح عند التخطي
  let allowStore = !userSkipped && ((items.length === 1 && items[0].inStore) || (items.length>1 && items.every(p=>p.inStore)));
  document.getElementById("complete-store").className = allowStore ? "complete-btn" : "complete-btn disabled";
  document.getElementById("complete-store").disabled = !allowStore;
}

// حذف من السلة من صفحة الدفع
function removeCheckout(id) {
  removeFromCart(id);
  renderCheckout();
}

// ------ إتمام الطلب (مجرد تنبيه) -----
function completeOrder(type) {
  alert("تم إتمام الطلب بنجاح (" + (type === 'normal' ? "شحن عادي" : type === 'fast' ? "شحن سريع" : "استلام من المعرض") + ")");
  cart = [];
  hideCheckout();
  updateCartCount();
}

window.onload = function() { showProducts(); }
</script>
</body>
</html>
