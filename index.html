<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…ØªØ¬Ø± Ù‚ØµØ± Ø§Ù„Ø£ÙˆØ§Ù†ÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary: #035cb1;
      --accent: #13c391;
      --danger: #e44545;
      --bg: #c5c8cf;
      --card: #fff;
    }
    body {
      font-family: 'Cairo', Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      min-height: 100vh;
    }
    .main-wrapper {
      max-width: 1100px;
      margin: 55px auto 0;
      padding: 30px 30px 60px 30px;
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 8px 32px #0001;
    }
    .products-title {font-size: 2.1rem; margin-bottom: 28px;}
    .products-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 34px;
    }
    .product-card {
      background: #fafbfe;
      border-radius: 16px;
      box-shadow: 0 3px 13px #0001;
      padding: 22px 18px 16px 18px;
      text-align: center;
      transition: box-shadow 0.2s;
    }
    .product-card:hover { box-shadow: 0 8px 20px #0002; }
    .product-img {
      width: 100px; height: 100px;
      object-fit: contain;
      margin-bottom: 10px;
    }
    .product-name { font-size: 1.15rem; margin-bottom: 8px;}
    .badge {
      display: inline-block; margin: 2px 4px 2px 0; font-size: 12px;
      background: var(--accent); color: #fff;
      padding: 2px 9px; border-radius: 8px;
    }
    .cart-btn {
      margin-top: 16px; background: var(--primary); color: #fff;
      border: none; padding: 8px 30px; border-radius: 13px; cursor: pointer;
      font-size: 1rem; transition: background 0.18s;
    }
    .cart-btn:disabled {background: #b8b8b8; cursor:not-allowed;}
    .cart-link {
      position: fixed; top: 20px; left: 30px; z-index: 10;
      background: #f4f4f4; color: var(--primary); font-weight: bold;
      font-size: 1.1rem;
      padding: 12px 30px;
      border-radius: 24px; box-shadow: 0 2px 9px #0001;
      cursor: pointer; transition: background 0.2s;
      border: 2px solid #eaeaea;
    }
    .cart-link:hover {background: #e4eefa;}
    /* Popup */
    .popup-bg {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(24, 34, 56, 0.23);
      display: flex; align-items: center; justify-content: center; z-index: 100;
    }
    .popup {
      background: var(--card); padding: 36px 32px;
      border-radius: 22px; box-shadow: 0 7px 32px #0002;
      min-width: 340px; text-align: center;
    }
    .popup select, .popup button {
      font-size: 1.1rem;
      padding: 8px 12px;
      margin: 7px 0;
      width: 90%;
      border-radius: 9px;
      border: 1.5px solid #ccc;
      outline: none;
      margin-bottom: 18px;
      background: #f6f8fa;
    }
    .popup .skip-btn {
      background: none; color: var(--primary); border: none; cursor: pointer; font-size: 1.05rem; margin-top: 6px;
      text-decoration: underline;
    }
    /* Cart & checkout */
    .cart, .checkout {
      max-width: 650px; margin: 60px auto 0; background: var(--card);
      border-radius: 15px; box-shadow: 0 5px 18px #0002; padding: 22px 18px 28px 18px;
    }
    .cart h2, .checkout h2 {margin-top:0; margin-bottom: 20px;}
    .cart-items, .checkout-products {margin-bottom:20px;}
    .product-mini {
      display: flex; align-items: center; justify-content: space-between;
      border-bottom: 1px solid #eee; padding: 10px 0;
    }
    .product-mini:last-child {border-bottom:none;}
    .mini-name {flex:1;}
    .remove-btn {background: none; color: var(--danger); border:none; font-size:1.2rem; cursor: pointer;}
    .red-bar {
      background: #fbeaea; color: var(--danger);
      padding: 3px 9px; border-radius: 8px; margin-right: 12px; font-size:13px;
    }
    .green {color: #14a659;}
    .red {color: var(--danger);}
    /* Checkout options */
    .checkout-options { margin: 24px 0;}
    .option-box {
      border: 1.5px solid #e6e6e6; border-radius: 13px; padding: 15px 16px 12px 16px; margin-bottom: 13px;
    }
    .option-title { font-weight: bold; font-size: 1.15rem;}
    .option-availability { margin-top: 5px; font-size: 14px; color:#666;}
    .disabled {opacity: 0.4; pointer-events: none;}
    .complete-btn {background: var(--accent); color: #fff; padding: 9px 22px; border: none; border-radius: 11px; cursor: pointer; margin-top: 18px;}
    @media (max-width:950px) {
      .main-wrapper {max-width:98vw;}
      .products-grid {grid-template-columns: 1fr;}
      .cart-link {left: 8px;}
    }
    @media (max-width:700px) {
      .main-wrapper {padding:8px;}
      .cart, .checkout {padding:10px;}
      .popup {min-width:90vw;}
    }
  </style>
</head>
<body>
<!-- Ø§Ù„Ø¨ÙˆØ¨ Ø§Ø¨ -->
<div id="popup-bg" class="popup-bg">
  <div class="popup">
    <h2 style="margin-bottom:17px;">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø­ÙŠ</h2>
    <select id="city">
      <option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
      <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
    </select><br>
    <select id="district">
      <option value="" selected disabled>Ø§Ø®ØªØ± Ø§Ù„Ø­ÙŠ</option>
      <option value="Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯">Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯</option>
    </select><br>
    <button class="cart-btn" style="width:92%;" id="confirm-location">ØªØ£ÙƒÙŠØ¯</button>
    <br>
    <button class="skip-btn" onclick="skipLocation()">ØªØ®Ø·ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</button>
  </div>
</div>

<div class="cart-link" onclick="showCart()">
  ğŸ›’ Ø§Ù„Ø³Ù„Ø© (<span id="cart-count">0</span>)
</div>

<div class="main-wrapper" id="main-wrapper">
  <div class="products-title">Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§</div>
  <div class="products-grid" id="products-list"></div>
</div>

<!-- Ø§Ù„Ø³Ù„Ø© -->
<div id="cart" class="cart" style="display:none;">
  <h2>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
  <div class="cart-items" id="cart-items"></div>
  <button class="cart-btn" style="margin-top:18px;" onclick="goCheckout()">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
  <button class="cart-btn" style="background:#bbb;color:#333;margin-top:18px;" onclick="hideCart()">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚</button>
</div>

<!-- ØµÙØ­Ø© Ø§ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ -->
<div id="checkout" class="checkout" style="display:none;">
  <h2>Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</h2>
  <div class="checkout-options">
    <div class="option-box">
      <div class="option-title">ğŸšš Ø´Ø­Ù† Ø¹Ø§Ø¯ÙŠ</div>
      <div class="option-availability" id="normal-availability"></div>
      <div class="checkout-products" id="normal-products"></div>
      <button class="complete-btn" id="complete-normal" onclick="completeOrder('normal')">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
    <div class="option-box">
      <div class="option-title">âš¡ Ø´Ø­Ù† Ø³Ø±ÙŠØ¹</div>
      <div class="option-availability" id="fast-availability"></div>
      <div class="checkout-products" id="fast-products"></div>
      <button class="complete-btn" id="complete-fast" onclick="completeOrder('fast')">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
    <div class="option-box">
      <div class="option-title">ğŸª Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶</div>
      <div class="option-availability" id="store-availability"></div>
      <div class="checkout-products" id="store-products"></div>
      <div style="margin-top:8px;font-size:15px;">Ù…Ø¹Ø±Ø¶ Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯:
        <span id="store-status"></span>
      </div>
      <button class="complete-btn" id="complete-store" onclick="completeOrder('store')">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
  </div>
  <button class="cart-btn" style="background:#bbb;color:#333;" onclick="hideCheckout()">Ø¹ÙˆØ¯Ø©</button>
</div>

<script>
const products = [
  {
    id: 1,
    name: "Ù‚Ù„Ø§ÙŠØ© Ù‡ÙˆØ§Ø¦ÙŠØ©",
    image: "https://imgs.qasralawani.net/media/catalog/product/d/s/dsc_0507.jpg",
    stock: { 'Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯': 1, 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': 0 }
  },
  {
    id: 2,
    name: "Ù…Ø§ÙƒÙŠÙ†Ø© Ù‚Ù‡ÙˆØ©",
    image: "https://i.imgur.com/I0u1PLP.png",
    stock: { 'Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯': 0, 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': 1 }
  },
  {
    id: 3,
    name: "Ù…Ø§ÙŠÙƒØ±ÙˆÙŠÙŠÙ",
    image: "https://i.imgur.com/bP3OKDT.png",
    stock: { 'Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯': 1, 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': 1 }
  },
];

let userDistrict = "";
let userSkipped = false;
let cart = [];

// Ø§Ù„Ø¨ÙˆØ¨ Ø§Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
document.getElementById("confirm-location").onclick = () => {
  const city = document.getElementById("city").value;
  const dist = document.getElementById("district").value;
  if(city && dist) {
    userDistrict = dist;
    userSkipped = false;
    document.getElementById("popup-bg").style.display = "none";
    showProducts();
  }
}

function skipLocation() {
  userDistrict = "";
  userSkipped = true;
  document.getElementById("popup-bg").style.display = "none";
  showProducts();
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙƒÙƒØ±ÙˆØª
function showProducts() {
  let html = "";
  products.forEach(p => {
    // ÙÙ‚Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¥Ø°Ø§ ØªÙ… Ø§Ù„ØªØ®Ø·ÙŠ
    let available = userSkipped
      ? (p.stock['Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] > 0)
      : (p.stock['Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] > 0 || (userDistrict == "Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯" && p.stock['Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯'] > 0));
    let badge = "";
    if (p.stock['Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] > 0) badge += `<span class="badge">Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>`;
    if (!userSkipped && userDistrict == "Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯" && p.stock['Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯'] > 0) badge += `<span class="badge" style="background:#1e97ed">Ù…ØªÙˆÙØ± ÙÙŠ Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯</span>`;
    html += `
      <div class="product-card">
        <img src="${p.image}" class="product-img" alt="${p.name}">
        <div class="product-name">${p.name}</div>
        ${badge}
        <br>
        <button class="cart-btn" onclick="addToCart(${p.id})" ${available ? "" : "disabled"}>Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
      </div>
    `;
  });
  document.getElementById("products-list").innerHTML = html;
  updateCartCount();
}

// ---- Ø§Ù„Ø³Ù„Ø© ----
function showCart() {
  document.getElementById("cart").style.display = "block";
  let html = "";
  cart.forEach(item => {
    const p = products.find(x=>x.id==item.id);
    html += `
      <div class="product-mini">
        <span class="mini-name">${p.name}</span>
        <button class="remove-btn" onclick="removeFromCart(${p.id})">âœ•</button>
      </div>
    `;
  });
  document.getElementById("cart-items").innerHTML = html || "<div>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>";
}

function hideCart() {
  document.getElementById("cart").style.display = "none";
}

function addToCart(id) {
  if(!cart.some(x=>x.id==id)) cart.push({id});
  updateCartCount();
  showCart();
}

function removeFromCart(id) {
  cart = cart.filter(x=>x.id != id);
  showCart();
  updateCartCount();
}

function updateCartCount() {
  document.getElementById("cart-count").textContent = cart.length;
}

// ---- Ø§ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ----
function goCheckout() {
  document.getElementById("cart").style.display = "none";
  document.getElementById("checkout").style.display = "block";
  renderCheckout();
}

function hideCheckout() {
  document.getElementById("checkout").style.display = "none";
  showProducts();
}

function renderCheckout() {
  const items = cart.map(c => {
    const prod = products.find(p => p.id == c.id);
    return {
      ...prod,
      inStore: prod.stock['Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯'] > 0,
      inOnline: prod.stock['Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] > 0
    }
  });

  // Ø´Ø­Ù† Ø¹Ø§Ø¯ÙŠ: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙÙ‚Ø·
  let normalAvail = items.filter(p => p.inOnline).length;
  document.getElementById("normal-availability").innerHTML =
    `${normalAvail} Ù…Ù† ${items.length} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø©`;
  let normalProds = "";
  items.forEach(item => {
    normalProds += `<div style="margin-bottom:7px;">
      <span>${item.name}</span>
      ${!item.inOnline ? `<span class="red-bar">ØºÙŠØ± Ù…ØªÙˆÙØ± Ù„Ù„ØªÙˆØµÙŠÙ„</span> <button class="remove-btn" onclick="removeCheckout(${item.id})">Ø­Ø°Ù</button>` : ""}
    </div>`;
  });
  document.getElementById("normal-products").innerHTML = normalProds;

  // Ø´Ø­Ù† Ø³Ø±ÙŠØ¹: Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯ ÙˆØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯ ÙÙ‚Ø· (ØºÙŠØ± Ù…ØªØ§Ø­ Ø¹Ù†Ø¯ Ø§Ù„ØªØ®Ø·ÙŠ)
  let allowFast = !userSkipped && userDistrict === "Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯" && items.length>0 && items.every(p=>p.inStore);
  document.getElementById("fast-availability").innerHTML =
    allowFast ? `${items.length} Ù…Ù† ${items.length} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø© (Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯)` :
    `Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ Ù…ØªØ§Ø­ ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯`;
  let fastProds = "";
  items.forEach(item => {
    fastProds += `<div style="margin-bottom:7px;">
      <span>${item.name}</span>
      ${(!item.inStore && allowFast) ? `<span class="red-bar">ØºÙŠØ± Ù…ØªÙˆÙØ± Ù„Ù„Ø´Ø­Ù† Ø§Ù„Ø³Ø±ÙŠØ¹</span> <button class="remove-btn" onclick="removeCheckout(${item.id})">Ø­Ø°Ù</button>` : ""}
    </div>`;
  });
  document.getElementById("fast-products").innerHTML = fastProds;
  document.getElementById("complete-fast").className = allowFast ? "complete-btn" : "complete-btn disabled";
  document.getElementById("complete-fast").disabled = !allowFast;

  // Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶ (Ù…ØªØ§Ø­ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªØ®Ø·ÙŠ)
  let storeAvail = items.filter(p => p.inStore).length;
  document.getElementById("store-availability").innerHTML =
    `${storeAvail} Ù…Ù† ${items.length} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø©`;
  let storeProds = "";
  items.forEach(item => {
    storeProds += `<div style="margin-bottom:7px;">
      <span>${item.name}</span>
      ${!item.inStore ? `<span class="red-bar">ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ù…Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±ÙˆØ¯</span> <button class="remove-btn" onclick="removeCheckout(${item.id})">Ø­Ø°Ù</button>` : ""}
    </div>`;
  });
  document.getElementById("store-products").innerHTML = storeProds;
  if (storeAvail > 0)
    document.getElementById("store-status").innerHTML = `<span class="green">Ù…ØªÙˆÙØ± (${storeAvail})</span>`;
  else
    document.getElementById("store-status").innerHTML = `<span class="red">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø©</span>`;
  // Ø²Ø± Ø§Ù„Ø¥ØªÙ…Ø§Ù… Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶: ØºÙŠØ± Ù…ØªØ§Ø­ Ø¹Ù†Ø¯ Ø§Ù„ØªØ®Ø·ÙŠ
  let allowStore = !userSkipped && ((items.length === 1 && items[0].inStore) || (items.length>1 && items.every(p=>p.inStore)));
  document.getElementById("complete-store").className = allowStore ? "complete-btn" : "complete-btn disabled";
  document.getElementById("complete-store").disabled = !allowStore;
}

// Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³Ù„Ø© Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
function removeCheckout(id) {
  removeFromCart(id);
  renderCheckout();
}

// ------ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø¬Ø±Ø¯ ØªÙ†Ø¨ÙŠÙ‡) -----
function completeOrder(type) {
  alert("ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ (" + (type === 'normal' ? "Ø´Ø­Ù† Ø¹Ø§Ø¯ÙŠ" : type === 'fast' ? "Ø´Ø­Ù† Ø³Ø±ÙŠØ¹" : "Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶") + ")");
  cart = [];
  hideCheckout();
  updateCartCount();
}

window.onload = function() { showProducts(); }
</script>
</body>
</html>
