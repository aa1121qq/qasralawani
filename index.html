<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù…ØªØ¬Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Cairo', Arial, sans-serif; background: #f9f9f9; margin: 0; }
    .popup-bg {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; z-index: 10;
    }
    .popup {
      background: #fff; padding: 32px 24px; border-radius: 20px; box-shadow: 0 4px 24px #0002; width: 300px; text-align: center;
    }
    .products, .cart, .checkout { max-width: 410px; margin: 36px auto; background: #fff; border-radius: 16px; box-shadow: 0 4px 18px #0001; padding: 18px 20px;}
    .products h2, .cart h2, .checkout h2 {margin: 0 0 12px;}
    .product {
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid #eee; padding: 8px 0;
    }
    .product:last-child { border-bottom: none; }
    .product img { width: 60px; height: 60px; object-fit: cover; border-radius: 12px;}
    .cart-btn { background: #222; color: #fff; border: none; padding: 8px 16px; border-radius: 10px; cursor: pointer; }
    .cart-btn[disabled] { background: #bbb; cursor: not-allowed;}
    .badge { background: #0ca678; color: #fff; font-size: 13px; padding: 3px 9px; border-radius: 7px; margin-right: 6px;}
    .cart-link { position: fixed; top: 12px; left: 18px; background: #e0e0e0; padding: 8px 22px; border-radius: 24px; cursor: pointer; font-weight: bold;}
    .red-bar {background: #ffdddd; color: #c00; padding: 5px 9px; border-radius: 7px; margin-top: 6px;}
    .green {color: #23a827;}
    .red {color: #c00;}
    .remove-btn {background: none; border: none; color: #c00; margin-right: 8px; cursor: pointer;}
    .checkout-options { margin: 20px 0;}
    .option-box { border: 1.5px solid #eee; border-radius: 12px; padding: 14px; margin-bottom: 10px;}
    .option-title { font-weight: bold; }
    .option-availability { margin-top: 5px; font-size: 13px; }
    .disabled {opacity: 0.4; pointer-events: none;}
    .hidden {display: none;}
    .complete-btn { background: #0ca678; color: #fff; padding: 9px 18px; border: none; border-radius: 10px; cursor: pointer; margin-top: 22px;}
    @media (max-width:480px) {
      .products, .cart, .checkout {max-width: 99vw; padding: 10px;}
      .popup {width: 95vw;}
      .cart-link {left: 8px; top: 8px;}
    }
  </style>
</head>
<body>
<!-- Location Popup -->
<div id="popup-bg" class="popup-bg">
  <div class="popup">
    <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø­ÙŠ</h2>
    <select id="city" style="width: 100%;margin-bottom:15px;">
      <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
    </select>
    <select id="district" style="width: 100%;margin-bottom:15px;">
      <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ø­ÙŠ</option>
      <option value="Ø­ÙŠ Ø§Ù„Ù…Ø¹Ø°Ø±">Ø­ÙŠ Ø§Ù„Ù…Ø¹Ø°Ø±</option>
      <option value="Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯">Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯</option>
    </select>
    <button class="cart-btn" id="confirm-location">ØªØ£ÙƒÙŠØ¯</button>
  </div>
</div>

<div class="cart-link" onclick="showCart()">
  ğŸ›’ Ø§Ù„Ø³Ù„Ø© (<span id="cart-count">0</span>)
</div>

<!-- Ù…Ù†ØªØ¬Ø§Øª -->
<div id="products" class="products">
  <h2>Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§</h2>
  <div id="products-list"></div>
</div>

<!-- Ø§Ù„Ø³Ù„Ø© -->
<div id="cart" class="cart hidden">
  <h2>Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h2>
  <div id="cart-items"></div>
  <button class="cart-btn" style="margin-top:16px;" onclick="goCheckout()">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
  <button class="cart-btn" style="background:#bbb;color:#333;margin-top:16px;" onclick="hideCart()">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØ³ÙˆÙ‚</button>
</div>

<!-- ØµÙØ­Ø© Ø§ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ -->
<div id="checkout" class="checkout hidden">
  <h2>Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</h2>
  <div class="checkout-options">
    <div class="option-box">
      <div class="option-title">ğŸšš ØªÙˆØµÙŠÙ„ Ù…Ù†Ø²Ù„ÙŠ</div>
      <div class="option-availability" id="home-availability"></div>
      <div id="home-products"></div>
      <button class="complete-btn" id="complete-home" onclick="completeOrder('home')">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
    <div class="option-box">
      <div class="option-title">ğŸª Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶</div>
      <div class="option-availability" id="store-availability"></div>
      <div id="store-products"></div>
      <div style="margin-top:9px">Ù…Ø¹Ø±Ø¶ Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯: <span id="store-status"></span></div>
      <button class="complete-btn" id="complete-store" onclick="completeOrder('store')">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</button>
    </div>
  </div>
  <button class="cart-btn" style="background:#bbb;color:#333;" onclick="hideCheckout()">Ø¹ÙˆØ¯Ø©</button>
</div>

<script>
const products = [
  {
    id: 1,
    name: "Ù‚Ù„Ø§ÙŠØ© Ù‡ÙˆØ§Ø¦ÙŠØ©",
    image: "https://imgs.qasralawani.net/media/catalog/product/d/s/dsc_0507.jpg",
    stock: { 'Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯': 1, 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': 0 }
  },
  {
    id: 2,
    name: "Ù…Ø§ÙƒÙŠÙ†Ø© Ù‚Ù‡ÙˆØ©",
    image: "https://i.imgur.com/I0u1PLP.png",
    stock: { 'Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯': 0, 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': 1 }
  },
  {
    id: 3,
    name: "Ù…Ø§ÙŠÙƒØ±ÙˆÙŠÙŠÙ",
    image: "https://i.imgur.com/bP3OKDT.png",
    stock: { 'Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯': 1, 'Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ': 1 }
  },
];

let userDistrict = "";
let cart = [];

// -------------------- Ø§Ù„Ù…ÙˆÙ‚Ø¹ -----------------------
document.getElementById("confirm-location").onclick = () => {
  const dist = document.getElementById("district").value;
  if(dist) {
    userDistrict = dist;
    document.getElementById("popup-bg").style.display = "none";
    showProducts();
  }
}

// ------------------- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -------------------
function showProducts() {
  let html = "";
  products.forEach(p => {
    // Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
    let available = p.stock['Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] > 0 || (userDistrict == "Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯" && p.stock['Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯'] > 0);
    let badge = "";
    if (p.stock['Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] > 0) badge += `<span class="badge">Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>`;
    if (userDistrict == "Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯" && p.stock['Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯'] > 0) badge += `<span class="badge">Ù…ØªÙˆÙØ± ÙÙŠ Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯</span>`;
    html += `
      <div class="product">
        <div>
          <img src="${p.image}" alt="${p.name}">
        </div>
        <div style="flex:1; padding:0 13px;">
          <div>${p.name}</div>
          ${badge}
        </div>
        <button class="cart-btn" onclick="addToCart(${p.id})" ${available ? "" : "disabled"}>Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
      </div>
    `;
  });
  document.getElementById("products-list").innerHTML = html;
  updateCartCount();
}

// ------------------- Ø§Ù„Ø³Ù„Ø© -------------------
function showCart() {
  document.getElementById("cart").classList.remove("hidden");
  let html = "";
  cart.forEach(item => {
    const p = products.find(x=>x.id==item.id);
    html += `
      <div class="product">
        <div><img src="${p.image}" alt="${p.name}"></div>
        <div style="flex:1; padding:0 13px;">${p.name}</div>
        <button class="remove-btn" onclick="removeFromCart(${p.id})">Ø­Ø°Ù</button>
      </div>
    `;
  });
  document.getElementById("cart-items").innerHTML = html || "<div>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>";
}

function hideCart() {
  document.getElementById("cart").classList.add("hidden");
}

function addToCart(id) {
  if(!cart.some(x=>x.id==id)) cart.push({id});
  updateCartCount();
  showCart();
}

function removeFromCart(id) {
  cart = cart.filter(x=>x.id != id);
  showCart();
  updateCartCount();
}

function updateCartCount() {
  document.getElementById("cart-count").textContent = cart.length;
}

// ------------------- Ø§ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ -------------------
function goCheckout() {
  document.getElementById("cart").classList.add("hidden");
  document.getElementById("checkout").classList.remove("hidden");
  renderCheckout();
}

function hideCheckout() {
  document.getElementById("checkout").classList.add("hidden");
  showProducts();
}

// Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©/Ø§Ù„ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ù„ÙƒÙ„ Ø®ÙŠØ§Ø±
function renderCheckout() {
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ø©
  const items = cart.map(c => {
    const prod = products.find(p => p.id == c.id);
    return {
      ...prod,
      inStore: prod.stock['Ù…Ø®Ø²Ù† Ø§Ù„ÙˆØ±ÙˆØ¯'] > 0,
      inOnline: prod.stock['Ù…Ø®Ø²Ù† Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠ'] > 0
    }
  });

  // ----- ØªÙˆØµÙŠÙ„ Ù…Ù†Ø²Ù„ÙŠ -----
  let homeAvail = items.filter(p => p.inOnline).length;
  let homeNotAvail = items.filter(p => !p.inOnline);
  document.getElementById("home-availability").innerHTML =
    `${homeAvail} Ù…Ù† ${items.length} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø©`;
  let homeProds = "";
  items.forEach(item => {
    homeProds += `
      <div style="margin-bottom:7px;">
        <span>${item.name}</span>
        ${!item.inOnline ? `<span class="red-bar">ØºÙŠØ± Ù…ØªÙˆÙØ± Ù„Ù„ØªÙˆØµÙŠÙ„</span> <button class="remove-btn" onclick="removeCheckout(${item.id})">Ø­Ø°Ù</button>` : ""}
      </div>`;
  });
  document.getElementById("home-products").innerHTML = homeProds;

  // ----- Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶ (Ø­ÙŠ Ø§Ù„ÙˆØ±ÙˆØ¯) -----
  let storeAvail = items.filter(p => p.inStore).length;
  let storeNotAvail = items.filter(p => !p.inStore);
  document.getElementById("store-availability").innerHTML =
    `${storeAvail} Ù…Ù† ${items.length} Ù…Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø©`;
  let storeProds = "";
  items.forEach(item => {
    storeProds += `
      <div style="margin-bottom:7px;">
        <span>${item.name}</span>
        ${!item.inStore ? `<span class="red-bar">ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ù…Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±ÙˆØ¯</span> <button class="remove-btn" onclick="removeCheckout(${item.id})">Ø­Ø°Ù</button>` : ""}
      </div>`;
  });
  document.getElementById("store-products").innerHTML = storeProds;
  // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¹Ø±Ø¶
  if (storeAvail > 0)
    document.getElementById("store-status").innerHTML = `<span class="green">Ù…ØªÙˆÙØ± (${storeAvail})</span>`;
  else
    document.getElementById("store-status").innerHTML = `<span class="red">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªÙˆÙØ±Ø©</span>`;

  // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ø°Ø§ Ù„Ù… ØªØªØ­Ù‚Ù‚ Ø§Ù„Ø´Ø±ÙˆØ·
  const allowHome = (items.length>0 && items.every(p=>p.inOnline))
  document.getElementById("complete-home").className = allowHome ? "complete-btn" : "complete-btn disabled";
  document.getElementById("complete-home").disabled = !allowHome;

  const allowStore = (items.length === 1 && items[0].inStore) || (items.length>1 && items.every(p=>p.inStore));
  document.getElementById("complete-store").className = allowStore ? "complete-btn" : "complete-btn disabled";
  document.getElementById("complete-store").disabled = !allowStore;
}

function removeCheckout(id) {
  removeFromCart(id);
  renderCheckout();
}

// ------ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø¬Ø±Ø¯ ØªÙ†Ø¨ÙŠÙ‡) -----
function completeOrder(type) {
  alert("ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ (" + (type === 'home' ? "ØªÙˆØµÙŠÙ„ Ù…Ù†Ø²Ù„ÙŠ" : "Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„Ù…Ø¹Ø±Ø¶") + ")");
  cart = [];
  hideCheckout();
  updateCartCount();
}

window.onload = function() { showProducts(); }
</script>
</body>
</html>
